---
title: "StreetEvents updates"
author: "Ian Gow"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
    pdf_document:
        fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## StreetEvents update

```{r data_step, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(scales)

pg <- src_postgres(host="iangow.me", dbname="crsp")

calls <- tbl(pg, sql("SELECT * FROM streetevents.calls"))
speaker_data <- tbl(pg, sql("SELECT * FROM streetevents.speaker_data"))
call_files<- tbl(pg, sql("SELECT * FROM streetevents.call_files"))
```

```{r most_recent}
calls %>%
    select(last_update) 
```

```{r call_date, message=FALSE, fig.cap="Histogram of `call_date` on `calls`"}
calls %>%
    mutate(call_month=date_trunc('month', call_date)) %>%
    select(call_month) %>%
    collect() %>%
    ggplot(aes(x=call_month)) +
    geom_histogram()
```

```{r last_update, message=FALSE, fig.cap="Histogram of `last_update` on `calls`"}
calls %>%
    collect() %>%
    ggplot(aes(x=last_update)) +
    geom_histogram()
```

```{r last_update_speaker, message=FALSE, fig.cap="Histogram of `last_update` on `speaker_data`"}
speaker_data %>%
    select(file_name, last_update) %>%
    distinct() %>%
    collect() %>%
    ggplot(aes(x=last_update)) +
    geom_histogram()
```

```{r mtime, message=FALSE, fig.cap="Histogram of `mtime` on `call_files`"}
call_files %>%
    collect() %>%
    ggplot(aes(x=mtime)) +
    geom_histogram()
```
